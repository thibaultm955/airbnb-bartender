<head>
    <title>D3 tutorial</title>
   <script src="http://d3js.org/d3.v3.min.js" charset="utf-8"></script>
    <!--<script src="d3.min.js"></script>-->
</head> 

<body>

<div class="container">
<h1> My Bookings </h1>
<!-- <ul>
    <%@bookings.each do |booking|%>
    <%if params[:bartender_id] == nil%>
        <li> <a href="./bookings/<%=booking.id%>"><%=booking.start_date%> - <%= booking.end_date%> by <%=booking.user.first_name%> for bartender <%=booking.bartender.user.first_name%> </a><%= button_to "Delete", { action: "destroy", id: booking.id }, method: :delete, data: { confirm: "Are you sure?" }  %> </li>
    <%else%>
        <li> <a href="./bookings/<%=booking.id%>"><%=booking.start_date%> - <%= booking.end_date%> by <%=booking.user.first_name%> for bartender <%=booking.bartender.user.first_name%> </a> </li>
    <%end%>
    <%end%>
</ul>

-->




<div class="row">
  <table class="table table-bordered">

      <thead>
        <th>Start Date</th>
        <th>End Date</th>
        <th>Bartender</th>
        <th>Action</th>
        <th>Cost Booking</th>
      </thead>

      <%sum_cost = 0%>
      <tbody>
        <% @bookings.each do |booking| %>
          <% number_of_day_booking = (booking.end_date - booking.start_date).to_i + 1%>
          <%cost_booking = booking.bartender.price_per_day * number_of_day_booking%>
          <%sum_cost += cost_booking%>
          <tr>
            <td><%= booking.start_date %></td>
            <td><%= booking.end_date %></td>
            <td><%= booking.bartender.user.first_name%> <%=booking.bartender.user.last_name%></td>
            <td><%= link_to user_booking_path(@user.id, booking) do %>
               <i class="fas fa-eye"></i>
              <% end %>
              <%= link_to user_bookings_path(booking), method: :delete, data: { confirm: "Are you sure?" } do %>
              <i class="fa fa-trash destroy_dose"></i></td>
            <td> <%=number_of_day_booking%> days * <%=booking.bartender.price_per_day%> € =  <%=cost_booking%> € </td>
            <% end %>
          </tr>
        <% end %>
      </tbody>
        <tfoot>
          <tr>
            <td>Sum</td>
            <td></td>
            <td></td>
            <td></td>
            <td><%= sum_cost%> €</td>
          </tr>
        </tfoot>
  </table>
</div>
<% flash.each do |key, value| %>
  <%= content_tag :div, class: "alert alert-success" do %>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close"><span aria-hidden="true">&times;</span></button>
    <h4 class="alert-heading">Thanks for your booking!</h4>
    <%= value %>
    <hr>
    <p class="mb-0">Total of your bookings: <%= sum_cost%> € </p>
    <%= link_to "Continue", bartenders_path %>
    <%= link_to "| Pay", bartenders_path %>

  <% end %>
<% end %>


<div class="mb-5">
  <%= link_to "< Back to Home" , root_path, class: "btn-ghost-noborder" %>
</div>

</div>
<%= javascript_pack_tag 'bookings','data-turbolinks-track': 'reload', defer: true %>


</body>